.direct-conversation-list
  - if conversations.present?
    %ul.direct-conversation-list__items
      - conversations.each do |conversation|
        - partner = conversation.other_participant(current_user)
        - partner_name = partner&.profile&.username.presence || partner&.email.presence || "Deleted user"
        - unread = conversation.unread_count_for(current_user)
        - last_message = conversation.last_message
        %li.direct-conversation-list__item
          - link_classes = ["direct-conversation-list__link", ("is-active" if active_conversation&.id == conversation.id)].compact
          = link_to direct_message_path(conversation), class: link_classes.join(" "), data: { turbo_frame: "_top", turbo_action: "advance" } do
            .direct-conversation-list__header
              %span.direct-conversation-list__name= partner_name
              - if unread.positive?
                %span.direct-conversation-list__badge= unread
            .direct-conversation-list__meta
              - if last_message.present?
                %span.direct-conversation-list__preview= truncate(last_message.body, length: 60)
                %span.direct-conversation-list__timestamp= l(last_message.created_at, format: :short)
              - else
                %span.text-muted.small No messages yet
  - else
    .direct-conversation-list__empty
      %p.text-muted.mb-0 You donâ€™t have any conversations yet.
