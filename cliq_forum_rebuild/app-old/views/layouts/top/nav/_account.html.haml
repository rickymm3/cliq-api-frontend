-# Renders in the top navbar. Bootstrap-first, no Tailwind required.
= turbo_frame_tag "account_nav" do
  - if user_signed_in?
    .d-flex.align-items-center.gap-2
      = turbo_frame_tag "notif_badge" do
        - unread = current_user.notifications.unread.count
        = link_to notifications_path,
                  class: "btn btn-outline-secondary btn-sm position-relative",
                  title: "Notifications",
                  data: { turbo_frame: "_top", turbo_action: "advance" } do
          -# If you have Bootstrap Icons, keep the bell; else replace with "Notifications"
          %i.bi.bi-bell
          - if unread.positive?
            %span.position-absolute.top-0.start-100.translate-middle.badge.rounded-pill.bg-danger
              = unread
              %span.visually-hidden unread notifications

      .dropdown
        %button.btn.btn-outline-secondary.btn-sm.dropdown-toggle{ data: { bs_toggle: "dropdown" }, aria: { expanded: "false" } }
          - uname = current_user&.profile&.username || current_user&.email || "Account"
          - initial = uname.to_s.first&.upcase || "U"
          %span.me-2.avatar-circle{ style: "display:inline-flex;width:22px;height:22px;border-radius:50%;align-items:center;justify-content:center;background:#0f172a;color:#fff;font-size:12px;" }= initial
          %span= uname
        %ul.dropdown-menu.dropdown-menu-end
          %li
            = link_to "Profile",
                      (current_user.profile ? profile_path(current_user.profile) : "#"),
                      class: "dropdown-item",
                      data: { turbo_frame: "_top", turbo_action: "advance" }
          %li
            = link_to "Settings", edit_user_registration_path,
                      class: "dropdown-item",
                      data: { turbo_frame: "_top", turbo_action: "advance" }
          %li
            %hr.dropdown-divider
          %li
            = button_to "Sign out",
                        destroy_user_session_path,
                        method: :delete,
                        class: "dropdown-item",
                        form: { data: { turbo: false } }
  - else
    .d-flex.gap-2
      = link_to "Log in",
                new_user_session_path,
                class: "btn btn-outline-secondary btn-sm",
                data: { turbo: false }
      = link_to "Sign up",
                new_user_registration_path,
                class: "btn btn-primary btn-sm",
                data: { turbo: false }
