<div class="container" data-controller="post-interaction">
  
  <!-- New Simplified Sticky Header -->
  <div class="sticky-top bg-white border-bottom shadow-sm px-3 py-2 mb-3 d-flex align-items-center justify-content-between" style="top: 0; z-index: 1020;">
    
    <!-- Title & Subscribe -->
    <div class="d-flex align-items-center flex-grow-1 overflow-hidden">
      <h1 class="h4 mb-0 text-truncate me-2 fw-bold"><%= @cliq["name"] %></h1>
      <%= render "subscribe_button", cliq_id: @cliq["id"], is_subscribed: @is_subscribed %>
    </div>

    <!-- Action Buttons (Icons Only) -->
    <div class="d-flex gap-2">
       <% if logged_in? %>
          <%= link_to new_cliq_post_path(@cliq["id"].to_i), class: "btn btn-outline-primary btn-sm rounded-circle d-flex align-items-center justify-content-center", style: "width: 32px; height: 32px;", title: "New Post" do %>
            <i class="bi bi-pencil-square"></i>
          <% end %>
          
          <%= link_to create_child_cliq_path(@cliq["id"].to_i), class: "btn btn-outline-secondary btn-sm rounded-circle d-flex align-items-center justify-content-center", style: "width: 32px; height: 32px;", title: "New Sub-Cliq" do %>
            <i class="bi bi-diagram-3"></i>
          <% end %>
          
          <%= link_to merge_proposal_cliq_path(@cliq["id"].to_i), class: "btn btn-outline-warning btn-sm rounded-circle d-flex align-items-center justify-content-center", style: "width: 32px; height: 32px;", title: "Propose Merge / Link" do %>
            <i class="bi bi-arrows-merge"></i>
          <% end %>
        <% else %>
          <%= link_to login_path, class: "btn btn-outline-primary btn-sm rounded-circle d-flex align-items-center justify-content-center", style: "width: 32px; height: 32px;", title: "Login to Post" do %>
            <i class="bi bi-box-arrow-in-right"></i>
          <% end %>
        <% end %>
    </div>
  </div>
    
    <!-- Cliq Header & Feed Column -->
    <div class="row">
      <div class="col-lg-8 sticky-header-col p-0">

      <!-- Posts List -->
      <%= render "feed_filter_toolbar" %>
      
      <%= turbo_frame_tag "posts_feed" do %>
        <% if @posts.any? %>
          <div class="mb-4">
            <h5 class="fw-bold mb-3">Posts (<%= @pagination&.dig("total_count") || @posts.length %>)</h5>
            <%= render partial: "posts/list", locals: { posts: @posts, pagination: @pagination || {} } %>
          </div>
        <% else %>
          <div class="alert alert-info" role="alert">
            <p class="mb-0">No posts yet. Be the first to start the conversation!</p>
          </div>
        <% end %>
      <% end %>
  
      </div> <!-- Close col-lg-8 -->

    <!-- Sidebar Navigation -->
    <div class="col-lg-4">
      <!-- Parent Navigation -->
      <% if @parent_cliq %>
        <div class="card border-0 shadow-sm mb-3">
          <div class="card-body">
            <small class="text-muted d-block mb-2">PARENT CLIQ</small>
            <%= link_to @parent_cliq["name"], cliq_path(@parent_cliq["id"]), class: "text-decoration-none fw-bold text-primary" %>
          </div>
        </div>
      <% end %>

      <!-- Current Cliq Info -->
      <div class="card border-0 shadow-sm mb-3">
        <div class="card-body">
          <h6 class="card-title fw-bold mb-2">
            <span class="badge bg-primary me-2">Current</span>
            <%= @cliq["name"] %>
          </h6>
          <hr>
          <p class="mb-3">
            <strong>Posts:</strong>
            <span class="badge bg-secondary"><%= @posts.length %></span>
          </p>
          <% if @cliq["description"].present? %>
            <p class="text-muted small"><%= @cliq["description"] %></p>
          <% end %>
        </div>
      </div>

      <!-- Search Posts in this Cliq -->
      <div class="card border-0 shadow-sm mb-3">
        <div class="card-body">
          <h6 class="card-title fw-bold mb-3">üîç Search</h6>
          <%= form_with url: search_path, method: :get, local: true do |f| %>
            <div class="mb-3">
              <label class="form-label small text-muted">Search posts in this cliq</label>
              <div class="input-group input-group-sm">
                <%= f.text_field :q, placeholder: "Find a post...", class: "form-control form-control-sm", value: "" %>
                <button class="btn btn-sm btn-outline-primary" type="submit">Go</button>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Children/Subcategories -->
      <% if @top_children_cliqs.any? %>
        <div class="card border-0 shadow-sm mb-3">
          <div class="card-body">
            <h6 class="card-title fw-bold mb-3">
              SUBCATEGORIES
              <% if @all_children_count > @top_children_cliqs.length %>
                <span class="badge bg-light text-dark small"><%= @all_children_count %></span>
              <% end %>
            </h6>

            <!-- Search Subcategories -->
            <div class="mb-3">
              <%= form_with url: search_path, method: :get, local: true do |f| %>
                <label class="form-label small text-muted">Search subcategories</label>
                <div class="input-group input-group-sm">
                  <%= f.text_field :q, placeholder: "Find a sub-cliq...", class: "form-control form-control-sm", value: "" %>
                  <button class="btn btn-sm btn-outline-secondary" type="submit">Go</button>
                </div>
              <% end %>
            </div>

            <div class="list-group list-group-flush">
              <% @top_children_cliqs.each do |child| %>
                <a href="<%= cliq_path(child["id"]) %>" class="list-group-item list-group-item-action border-0 px-0 py-2 d-flex justify-content-between align-items-center">
                  <%= child["name"] %>
                  <span class="badge bg-secondary"><%= child["posts_count"] || 0 %></span>
                </a>
              <% end %>
            </div>
            <% if @all_children_count > @top_children_cliqs.length %>
              <hr class="my-2">
              <%= link_to "View all #{@all_children_count} subcategories ‚Üí", children_cliq_path(@cliq["id"]), class: "btn btn-sm btn-outline-primary w-100" %>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Sibling Categories -->
      <% if @sibling_cliqs.any? %>
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h6 class="card-title fw-bold mb-3">RELATED CATEGORIES</h6>
            <div class="list-group list-group-flush">
              <% @sibling_cliqs.each do |sibling| %>
                <%= link_to sibling["name"], cliq_path(sibling["id"]), class: "list-group-item list-group-item-action border-0 px-0 py-2" %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Browse All -->
      <div class="card border-0 shadow-sm mt-3">
        <div class="card-body text-center">
          <%= link_to "Browse All Categories", root_path, class: "btn btn-sm btn-outline-secondary w-100" %>
        </div>
      </div>
    </div> <!-- Close col-lg-4 -->
    </div> <!-- Close row -->
</div> <!-- Close container -->


