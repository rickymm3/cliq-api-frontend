<div class="container" data-controller="post-interaction">
  
  <!-- Search Bar -->
  <div class="px-3 py-3 mb-3 bg-white border-bottom rounded-top">
    <form action="<%= search_path %>" method="get" class="w-100">
      <div class="input-group">
        <%= text_field_tag :q, "", placeholder: "Search cliqs...", class: "form-control", id: "feed-search" %>
        <button class="btn btn-primary" type="submit">
          <i class="bi bi-search"></i>
        </button>
      </div>
    </form>
  </div>
  
  <div class="sticky-top bg-white border-bottom shadow-sm px-3 py-2 mb-3 d-flex align-items-center justify-content-between" style="top: 0; z-index: 1020;">
    <div class="d-flex align-items-center flex-grow-1 overflow-hidden">
      <h1 class="h4 mb-0 text-truncate fw-bold">ðŸ“° Your Feed</h1>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-8">
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
          <ul class="nav nav-pills">
            <li class="nav-item">
              <%= link_to "Subscriptions", feed_path(type: 'subscribed'), class: "nav-link #{'active' if @feed_type.nil? || @feed_type == 'subscribed'}" %>
            </li>
            <li class="nav-item">
              <%= link_to "People You Follow", feed_path(type: 'following'), class: "nav-link #{'active' if @feed_type == 'following'}" %>
            </li>
          </ul>
        </div>
      </div>

      <!-- Posts Feed -->
      <%= turbo_frame_tag "posts_feed" do %>
        <% if @posts.any? %>
          <div class="mb-4">
             <%= render partial: "posts/list", locals: { posts: @posts, pagination: @pagination } %>
          </div>
        <% else %>
          <div class="alert alert-info" role="alert">
            <p class="mb-0">ðŸ“­ Your feed is empty.
            <% if @feed_type == 'following' %>
               Follow some users to see their posts here!
            <% else %>
               <%= link_to "Subscribe to some Cliqs", root_path %> to see posts here!
            <% end %>
            </p>
          </div>
        <% end %>
      <% end %>
    </div>

    <!-- Right Sidebar -->
    <div class="col-lg-4">
      <% if @user_profile %>
        <div class="card border-0 shadow-sm mb-3">
          <div class="card-body">
            <h6 class="card-title fw-bold mb-3">YOUR STATS</h6>
            <div class="d-flex justify-content-between text-center">
              <div>
                <h5 class="mb-0"><%= @user_profile["posts_count"] || 0 %></h5>
                <small class="text-muted">Posts</small>
              </div>
              <div>
                <a href="<%= user_following_path(@user_profile["id"]) %>" class="text-decoration-none text-dark">
                  <h5 class="mb-0"><%= @user_profile["following_count"] || 0 %></h5>
                  <small class="text-muted">Following</small>
                </a>
              </div>
              <div>
                <a href="<%= user_followers_path(@user_profile["id"]) %>" class="text-decoration-none text-dark">
                  <h5 class="mb-0"><%= @user_profile["followers_count"] || 0 %></h5>
                  <small class="text-muted">Followers</small>
                </a>
              </div>
            </div>
            <hr>
            <%= link_to "View Profile", user_profile_path(@user_profile["id"]), class: "btn btn-sm btn-outline-primary w-100" %>
          </div>
        </div>
      <% end %>

      <!-- My Subscriptions -->
      <% if @user_profile && @user_profile["subscriptions"] && @user_profile["subscriptions"].any? %>
        <div class="card border-0 shadow-sm mb-3">
          <div class="card-body">
            <h6 class="card-title fw-bold mb-3">YOUR CLIQS</h6>
            <div class="list-group list-group-flush">
              <% @user_profile["subscriptions"].first(5).each do |sub| %>
                <%= link_to cliq_path(sub["id"]), class: "list-group-item list-group-item-action border-0 px-0 py-2 d-flex justify-content-between align-items-center" do %>
                   <span><%= sub["name"] %></span>
                   <span class="badge bg-secondary rounded-pill"><%= sub["posts_count"] %></span>
                <% end %>
              <% end %>
            </div>
            <% if @user_profile["subscriptions"].length > 5 %>
               <hr class="my-2">
               <%= link_to "View All Subscriptions", user_profile_path(current_user[:id]), class: "btn btn-sm btn-outline-primary w-100" %>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- People I Follow -->
      <% if @following && @following.any? %>
        <div class="card border-0 shadow-sm mb-3">
          <div class="card-body">
            <h6 class="card-title fw-bold mb-3">PEOPLE YOU FOLLOW</h6>
            <div class="list-group list-group-flush">
              <% @following.first(5).each do |user| %>
                <%= link_to user_profile_path(user["id"]), class: "list-group-item list-group-item-action border-0 px-0 py-2 d-flex justify-content-between align-items-center" do %>
                   <div class="d-flex align-items-center">
                     <div class="avatar-circle bg-light text-secondary me-2 small" style="width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px;">ðŸ‘¤</div>
                     <span><%= user["email"].split('@').first %></span>
                   </div>
                   <span class="badge bg-secondary rounded-pill"><%= user["posts_count"] %></span>
                <% end %>
              <% end %>
            </div>
            <% if @following.length > 5 %>
               <hr class="my-2">
               <%= link_to "View All Following", user_following_path(current_user[:id]), class: "btn btn-sm btn-outline-primary w-100" %>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Browse/Global -->
      <div class="card border-0 shadow-sm mb-3">
        <div class="card-body">
           <h6 class="card-title fw-bold mb-3">EXPLORE</h6>
           <div class="list-group list-group-flush">
             <% if @main_cliqs && @main_cliqs.any? %>
               <% @main_cliqs.first(5).each do |cliq| %>
                 <%= link_to cliq["name"], cliq_path(cliq["id"]), class: "list-group-item list-group-item-action border-0 px-0 py-2" %>
               <% end %>
             <% end %>
           </div>
           <hr class="my-2">
           <%= link_to "Browse All Categories", root_path, class: "btn btn-sm btn-outline-primary w-100" %>
        </div>
      </div>
      
    </div>
  </div>
</div>
